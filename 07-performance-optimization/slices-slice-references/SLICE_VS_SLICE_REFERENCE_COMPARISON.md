# Rust åˆ‡ç‰‡ vs åˆ‡ç‰‡å¼•ç”¨ï¼šè¯¦ç»†å¯¹æ¯”åˆ†æ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸“é—¨å¯¹æ¯”åˆ†æ Rust ä¸­çš„**åˆ‡ç‰‡ (Slice)** å’Œ**åˆ‡ç‰‡å¼•ç”¨ (Slice Reference)** çš„åŒºåˆ«ï¼Œå¸®åŠ©å¼€å‘è€…å½»åº•ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚

## ğŸ” æ ¸å¿ƒå®šä¹‰å¯¹æ¯”

| ç‰¹æ€§ | åˆ‡ç‰‡ (Slice) | åˆ‡ç‰‡å¼•ç”¨ (Slice Reference) |
|------|-------------|---------------------------|
| **ç±»å‹è¡¨ç¤º** | `[T]` | `&[T]` æˆ– `&mut [T]` |
| **å¤§å°** | åŠ¨æ€å¤§å°ç±»å‹ (DST) | å›ºå®šå¤§å° (èƒ–æŒ‡é’ˆ) |
| **å­˜å‚¨ä½ç½®** | ä¸èƒ½ç›´æ¥å­˜å‚¨ | å¯ä»¥å­˜å‚¨åœ¨æ ˆä¸Š |
| **æ‰€æœ‰æƒ** | ä¸æ‹¥æœ‰æ•°æ® | ä¸æ‹¥æœ‰æ•°æ®ï¼Œåªæ˜¯å¼•ç”¨ |
| **ä½¿ç”¨æ–¹å¼** | é€šè¿‡å¼•ç”¨é—´æ¥ä½¿ç”¨ | ç›´æ¥ä½¿ç”¨ |

## ğŸ’¡ åŸºæœ¬æ¦‚å¿µåŒºåˆ«

### 1. åˆ‡ç‰‡ `[T]`

```rust
// åˆ‡ç‰‡æ˜¯ä¸€ä¸ªåŠ¨æ€å¤§å°ç±»å‹ (DST)
// ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥ï¼Œä¸èƒ½ç›´æ¥å®ä¾‹åŒ–
// let slice: [i32] = [1, 2, 3]; // âŒ ç¼–è¯‘é”™è¯¯ï¼

// åˆ‡ç‰‡åªèƒ½é€šè¿‡å¼•ç”¨æ¥ä½¿ç”¨
let array = [1, 2, 3, 4, 5];
let slice_ref: &[i32] = &array[1..4]; // âœ… æ­£ç¡®
```

### 2. åˆ‡ç‰‡å¼•ç”¨ `&[T]`

```rust
// åˆ‡ç‰‡å¼•ç”¨æ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆï¼ŒåŒ…å«ï¼š
// - æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ
// - åˆ‡ç‰‡çš„é•¿åº¦
let array = [1, 2, 3, 4, 5];
let slice_ref: &[i32] = &array[1..4];

println!("åˆ‡ç‰‡å¼•ç”¨å¤§å°: {} å­—èŠ‚", std::mem::size_of_val(&slice_ref));
// åœ¨ 64 ä½ç³»ç»Ÿä¸Šè¾“å‡º: 16 å­—èŠ‚ (8å­—èŠ‚æŒ‡é’ˆ + 8å­—èŠ‚é•¿åº¦)
```

## ğŸ—ï¸ å†…å­˜å¸ƒå±€å¯¹æ¯”

### åˆ‡ç‰‡ `[T]` çš„å†…å­˜å¸ƒå±€

```
åˆ‡ç‰‡æœ¬èº« (æ¦‚å¿µä¸Šçš„è¿ç»­å†…å­˜åŒºåŸŸ):
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  T  â”‚  T  â”‚  T  â”‚  T  â”‚  <- å®é™…æ•°æ®
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

### åˆ‡ç‰‡å¼•ç”¨ `&[T]` çš„å†…å­˜å¸ƒå±€

```
åˆ‡ç‰‡å¼•ç”¨ (èƒ–æŒ‡é’ˆ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æŒ‡é’ˆåœ°å€    â”‚    é•¿åº¦å€¼     â”‚  <- 16å­—èŠ‚ (64ä½ç³»ç»Ÿ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚  T  â”‚  T  â”‚  T  â”‚  T  â”‚  <- æŒ‡å‘çš„å®é™…æ•°æ®
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å®é™…ä»£ç å¯¹æ¯”

### ç¤ºä¾‹ 1: ç±»å‹å£°æ˜å¯¹æ¯”

```rust
fn demonstrate_type_differences() {
    let array = [1, 2, 3, 4, 5];
    
    // âŒ ä¸èƒ½ç›´æ¥å£°æ˜åˆ‡ç‰‡ç±»å‹
    // let slice: [i32] = array[1..4]; // ç¼–è¯‘é”™è¯¯
    
    // âœ… åªèƒ½é€šè¿‡å¼•ç”¨ä½¿ç”¨åˆ‡ç‰‡
    let slice_ref: &[i32] = &array[1..4];
    
    // ç±»å‹ä¿¡æ¯
    println!("array ç±»å‹: {}", std::any::type_name::<[i32; 5]>());
    println!("slice_ref ç±»å‹: {}", std::any::type_name::<&[i32]>());
    
    // å¤§å°ä¿¡æ¯
    println!("array å¤§å°: {} å­—èŠ‚", std::mem::size_of_val(&array));
    println!("slice_ref å¤§å°: {} å­—èŠ‚", std::mem::size_of_val(&slice_ref));
}
```

### ç¤ºä¾‹ 2: å‡½æ•°å‚æ•°å¯¹æ¯”

```rust
// âŒ ä¸èƒ½ç›´æ¥æ¥å—åˆ‡ç‰‡ç±»å‹ä½œä¸ºå‚æ•°
// fn process_slice(slice: [i32]) { } // ç¼–è¯‘é”™è¯¯

// âœ… åªèƒ½æ¥å—åˆ‡ç‰‡å¼•ç”¨ä½œä¸ºå‚æ•°
fn process_slice_ref(slice: &[i32]) {
    println!("å¤„ç†åˆ‡ç‰‡: {:?}", slice);
}

// âœ… ä¹Ÿå¯ä»¥æ¥å—å¯å˜åˆ‡ç‰‡å¼•ç”¨
fn process_mut_slice_ref(slice: &mut [i32]) {
    for item in slice.iter_mut() {
        *item *= 2;
    }
}

fn function_parameter_demo() {
    let mut array = [1, 2, 3, 4, 5];
    
    // ä¼ é€’ä¸å¯å˜åˆ‡ç‰‡å¼•ç”¨
    process_slice_ref(&array[1..4]);
    
    // ä¼ é€’å¯å˜åˆ‡ç‰‡å¼•ç”¨
    process_mut_slice_ref(&mut array[1..4]);
    
    println!("ä¿®æ”¹åçš„æ•°ç»„: {:?}", array);
}
```

### ç¤ºä¾‹ 3: æ‰€æœ‰æƒå’Œå€Ÿç”¨å¯¹æ¯”

```rust
fn ownership_comparison() {
    let vec = vec![1, 2, 3, 4, 5];
    
    // åˆ‡ç‰‡å¼•ç”¨ä¸æ‹¥æœ‰æ•°æ®
    let slice_ref1: &[i32] = &vec[1..4];
    let slice_ref2: &[i32] = &vec[2..5];
    
    // å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªä¸å¯å˜åˆ‡ç‰‡å¼•ç”¨
    println!("slice_ref1: {:?}", slice_ref1);
    println!("slice_ref2: {:?}", slice_ref2);
    
    // åŸå§‹æ•°æ®ä»ç„¶å¯ä»¥è®¿é—®
    println!("åŸå§‹ vec: {:?}", vec);
}

fn mutable_borrowing_demo() {
    let mut vec = vec![1, 2, 3, 4, 5];
    
    {
        // å¯å˜åˆ‡ç‰‡å¼•ç”¨
        let mut_slice: &mut [i32] = &mut vec[1..4];
        mut_slice[0] = 100;
        
        // åœ¨å¯å˜å€Ÿç”¨æœŸé—´ï¼Œä¸èƒ½æœ‰å…¶ä»–å€Ÿç”¨
        // let another_ref = &vec; // âŒ ç¼–è¯‘é”™è¯¯
    } // å¯å˜å€Ÿç”¨ç»“æŸ
    
    // ç°åœ¨å¯ä»¥å†æ¬¡å€Ÿç”¨
    println!("ä¿®æ”¹åçš„ vec: {:?}", vec);
}
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | åˆ‡ç‰‡ `[T]` | åˆ‡ç‰‡å¼•ç”¨ `&[T]` |
|------|-----------|----------------|
| **å†…å­˜å¼€é”€** | æ— é¢å¤–å¼€é”€ | 16å­—èŠ‚èƒ–æŒ‡é’ˆ |
| **è®¿é—®æ€§èƒ½** | ç›´æ¥è®¿é—® | é€šè¿‡æŒ‡é’ˆé—´æ¥è®¿é—® |
| **ä¼ é€’æˆæœ¬** | ä¸èƒ½ç›´æ¥ä¼ é€’ | é›¶æˆæœ¬ä¼ é€’ |
| **è¾¹ç•Œæ£€æŸ¥** | ç¼–è¯‘æ—¶ + è¿è¡Œæ—¶ | è¿è¡Œæ—¶ |

### æ€§èƒ½æµ‹è¯•ä»£ç 

```rust
use std::time::Instant;

fn performance_comparison() {
    let data: Vec<i32> = (0..1_000_000).collect();
    let slice_ref: &[i32] = &data;
    
    // æµ‹è¯•åˆ‡ç‰‡å¼•ç”¨è®¿é—®æ€§èƒ½
    let start = Instant::now();
    let mut sum = 0;
    for &value in slice_ref {
        sum += value;
    }
    let duration = start.elapsed();
    
    println!("åˆ‡ç‰‡å¼•ç”¨è¿­ä»£è€—æ—¶: {:?}", duration);
    println!("è®¡ç®—ç»“æœ: {}", sum);
    
    // æµ‹è¯•ç´¢å¼•è®¿é—®æ€§èƒ½
    let start = Instant::now();
    let mut sum = 0;
    for i in 0..slice_ref.len() {
        sum += slice_ref[i];
    }
    let duration = start.elapsed();
    
    println!("ç´¢å¼•è®¿é—®è€—æ—¶: {:?}", duration);
}
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯å¯¹æ¯”

### åˆ‡ç‰‡ `[T]` çš„ä½¿ç”¨åœºæ™¯

1. **ç±»å‹æ³¨è§£ä¸­**ï¼š
   ```rust
   fn process<T>(data: &[T]) -> &[T] {
       // å‡½æ•°ç­¾åä¸­ä½¿ç”¨åˆ‡ç‰‡ç±»å‹
       data
   }
   ```

2. **æ³›å‹çº¦æŸä¸­**ï¼š
   ```rust
   fn generic_function<T: AsRef<[u8]>>(data: T) {
       let slice: &[u8] = data.as_ref();
   }
   ```

### åˆ‡ç‰‡å¼•ç”¨ `&[T]` çš„ä½¿ç”¨åœºæ™¯

1. **å˜é‡å£°æ˜**ï¼š
   ```rust
   let slice_ref: &[i32] = &vec![1, 2, 3];
   ```

2. **å‡½æ•°å‚æ•°**ï¼š
   ```rust
   fn process_data(data: &[i32]) { }
   ```

3. **ç»“æ„ä½“å­—æ®µ**ï¼š
   ```rust
   struct DataProcessor<'a> {
       data: &'a [i32],
   }
   ```

## âš ï¸ å¸¸è§è¯¯åŒº

### è¯¯åŒº 1: æ··æ·†æ¦‚å¿µ

```rust
// âŒ é”™è¯¯ç†è§£
// "åˆ‡ç‰‡å°±æ˜¯åˆ‡ç‰‡å¼•ç”¨"

// âœ… æ­£ç¡®ç†è§£
// åˆ‡ç‰‡ [T] æ˜¯ç±»å‹ï¼Œåˆ‡ç‰‡å¼•ç”¨ &[T] æ˜¯å¯¹åˆ‡ç‰‡çš„å¼•ç”¨
let array = [1, 2, 3];
let slice_type: &[i32] = &array; // è¿™æ˜¯åˆ‡ç‰‡å¼•ç”¨ï¼Œä¸æ˜¯åˆ‡ç‰‡æœ¬èº«
```

### è¯¯åŒº 2: å¤§å°æ··æ·†

```rust
fn size_confusion_demo() {
    let array = [1, 2, 3, 4, 5];
    let slice_ref = &array[1..4];
    
    // âŒ é”™è¯¯è®¤ä¸ºåˆ‡ç‰‡å¼•ç”¨å¤§å°ç­‰äºæ•°æ®å¤§å°
    println!("åˆ‡ç‰‡å¼•ç”¨å¤§å°: {} å­—èŠ‚", std::mem::size_of_val(&slice_ref)); // 16å­—èŠ‚
    
    // âœ… æ­£ç¡®ç†è§£ï¼šåˆ‡ç‰‡å¼•ç”¨æŒ‡å‘çš„æ•°æ®å¤§å°
    println!("æŒ‡å‘æ•°æ®å¤§å°: {} å­—èŠ‚", std::mem::size_of_val(slice_ref)); // 12å­—èŠ‚
}
```

### è¯¯åŒº 3: æ‰€æœ‰æƒæ··æ·†

```rust
fn ownership_confusion() {
    let vec = vec![1, 2, 3, 4, 5];
    let slice_ref = &vec[1..4];
    
    // âŒ é”™è¯¯è®¤ä¸ºåˆ‡ç‰‡å¼•ç”¨æ‹¥æœ‰æ•°æ®
    // drop(vec); // è¿™ä¼šå¯¼è‡´ slice_ref æ‚¬å‚
    
    // âœ… æ­£ç¡®ç†è§£ï¼šåˆ‡ç‰‡å¼•ç”¨ä¸æ‹¥æœ‰æ•°æ®ï¼Œä¾èµ–åŸå§‹æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸ
    println!("åˆ‡ç‰‡å¼•ç”¨: {:?}", slice_ref);
    // vec å¿…é¡»åœ¨ slice_ref ä½¿ç”¨æœŸé—´ä¿æŒæœ‰æ•ˆ
}
```

## ğŸ”„ è½¬æ¢å…³ç³»

### ä»ä¸åŒç±»å‹åˆ›å»ºåˆ‡ç‰‡å¼•ç”¨

```rust
fn conversion_examples() {
    // ä»æ•°ç»„åˆ›å»ºåˆ‡ç‰‡å¼•ç”¨
    let array = [1, 2, 3, 4, 5];
    let from_array: &[i32] = &array;
    let from_array_range: &[i32] = &array[1..4];
    
    // ä» Vec åˆ›å»ºåˆ‡ç‰‡å¼•ç”¨
    let vec = vec![1, 2, 3, 4, 5];
    let from_vec: &[i32] = &vec;
    let from_vec_range: &[i32] = &vec[1..4];
    
    // ä»å­—ç¬¦ä¸²åˆ›å»ºåˆ‡ç‰‡å¼•ç”¨
    let string = String::from("hello");
    let from_string: &[u8] = string.as_bytes();
    
    println!("ä»æ•°ç»„: {:?}", from_array);
    println!("ä»æ•°ç»„èŒƒå›´: {:?}", from_array_range);
    println!("ä» Vec: {:?}", from_vec);
    println!("ä» Vec èŒƒå›´: {:?}", from_vec_range);
    println!("ä»å­—ç¬¦ä¸²: {:?}", from_string);
}
```

## ğŸ“ æ€»ç»“

### å…³é”®åŒºåˆ«æ€»ç»“

1. **æœ¬è´¨åŒºåˆ«**ï¼š
   - `[T]` æ˜¯åŠ¨æ€å¤§å°ç±»å‹ï¼Œè¡¨ç¤ºè¿ç»­å†…å­˜ä¸­çš„æ•°æ®åºåˆ—
   - `&[T]` æ˜¯æŒ‡å‘åˆ‡ç‰‡çš„å¼•ç”¨ï¼Œæ˜¯ä¸€ä¸ªèƒ–æŒ‡é’ˆ

2. **ä½¿ç”¨æ–¹å¼**ï¼š
   - `[T]` ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡å¼•ç”¨
   - `&[T]` å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ˜¯å®é™…ç¼–ç¨‹ä¸­ä½¿ç”¨çš„ç±»å‹

3. **å†…å­˜è¡¨ç¤º**ï¼š
   - `[T]` æ˜¯æ•°æ®æœ¬èº«
   - `&[T]` æ˜¯æŒ‡é’ˆ + é•¿åº¦çš„ç»„åˆ

4. **æ€§èƒ½ç‰¹æ€§**ï¼š
   - ä¸¤è€…éƒ½æä¾›é›¶æˆæœ¬æŠ½è±¡
   - åˆ‡ç‰‡å¼•ç”¨ä¼ é€’æˆæœ¬æä½
   - è®¿é—®æ€§èƒ½ç›¸å½“

### æœ€ä½³å®è·µ

1. **å‡½æ•°å‚æ•°**ï¼šä½¿ç”¨ `&[T]` è€Œä¸æ˜¯ `Vec<T>` ä»¥æé«˜çµæ´»æ€§
2. **API è®¾è®¡**ï¼šæ¥å—åˆ‡ç‰‡å¼•ç”¨å¯ä»¥åŒæ—¶å¤„ç†æ•°ç»„ã€Vec å’Œå…¶ä»–åˆ‡ç‰‡
3. **æ€§èƒ½è€ƒè™‘**ï¼šåˆ‡ç‰‡å¼•ç”¨æä¾›é›¶æˆæœ¬æŠ½è±¡ï¼Œæ— éœ€æ‹…å¿ƒæ€§èƒ½æŸå¤±
4. **ç”Ÿå‘½å‘¨æœŸ**ï¼šæ³¨æ„åˆ‡ç‰‡å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸èƒ½è¶…è¿‡åŸå§‹æ•°æ®

é€šè¿‡ç†è§£è¿™äº›åŒºåˆ«ï¼Œä½ å¯ä»¥æ›´å¥½åœ°ä½¿ç”¨ Rust çš„åˆ‡ç‰‡ç³»ç»Ÿï¼Œç¼–å†™æ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„ä»£ç ã€‚