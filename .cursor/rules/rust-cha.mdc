---
description: Rust 语言通用编码规范与最佳实践
globs: **/*.rs
alwaysApply: true
---

# Rust 规则

- **优先使用最新稳定版 Rust**：
  - 默认使用 stable 渠道（channel），定期跟随最新稳定版本升级
  - 仅在必要时使用 beta/nightly，并将不稳定特性的使用范围控制在极小的边界内
- **优先使用所有权、借用和生命周期模型**：理解并利用 Rust 的所有权系统，而不是逃避到 `unsafe` 代码
- **尽量使用不可变绑定**：默认使用 `let` 而不是 `let mut`，只有在确实需要可变时再引入可变性
- **使用 `Result` 和 `Option` 进行错误与空值处理**：避免滥用 `panic!`，通过 `?` 运算符传播错误
- **遵循 Rustfmt 和 Clippy 建议**：
  - 使用 `rustfmt` 自动格式化代码
  - 在 CI 中启用 `clippy`，及时修正代码异味和潜在问题
- **模块与包结构清晰**：
  - 将公共 API 放在 `lib.rs` 或清晰的模块中
  - 使用 `mod` 与 `pub` 合理划分可见性，避免过度暴露实现细节
- **使用 `cargo` 管理项目与依赖**：
  - 在 `Cargo.toml` 中明确声明依赖版本范围
  - 定期运行 `cargo update` 并检查变更
- **偏好零成本抽象**：
  - 善用迭代器、切片、模式匹配等语言特性编写简洁高效的代码
  - 优先选择标准库和成熟的社区 crate（如 `serde`、`tokio` 等）
- **测试与文档并重**：
  - 使用 `cargo test` 编写和运行单元测试、集成测试
  - 使用文档注释 `///` 为公共 API 编写文档，并使用 `cargo doc` 生成文档
- **并发与异步安全**：
  - 使用 `Send`、`Sync` 约束与所有权模型确保并发安全
  - 在异步代码中优先使用 `async/await` 与成熟运行时（如 `tokio`），避免阻塞调用

